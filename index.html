<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Stories Wall - Создай свою стенку из историй</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <!-- Важно: подключаем скрипт Telegram. Он нужен для проверки window.Telegram.WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        :root {
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --primary-color: #4A90E2;
            --text-color: #e0e0e0;
            --hint-color: #888888;
            --border-color: #333333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* === СТИЛИ ДЛЯ ЭКРАНА "ОТКРЫТЬ В БРАУЗЕРЕ" === */
        #browser-redirect-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 24px;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        #browser-redirect-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        #browser-redirect-overlay .icon {
            font-size: 64px;
            color: var(--primary-color);
            margin-bottom: 24px;
        }

        #browser-redirect-overlay h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 12px;
        }
        
        #browser-redirect-overlay p {
            font-size: 16px;
            color: var(--hint-color);
            line-height: 1.6;
            max-width: 350px;
            margin-bottom: 32px;
        }

        #openInBrowserBtn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            max-width: 350px;
            padding: 16px;
            font-size: 16px;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            background-color: var(--primary-color);
            color: #fff;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
        }
        #openInBrowserBtn:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        /* Остальные стили */
        .container { max-width: 500px; margin: 0 auto; padding: 24px 16px 100px 16px; position: relative; z-index: 10; }
        .hidden { display: none !important; }
        /* ... сюда можно вставить остальные стили из твоего файла, я их сократил для краткости ... */
    </style>
</head>
<body>

    <!-- ЭКРАН-ПЕРЕХВАТЧИК -->
    <div id="browser-redirect-overlay">
        <span class="material-symbols-outlined icon">open_in_browser</span>
        <h2>Один момент...</h2>
        <p>Для лучшей работы и скачивания файлов, пожалуйста, откройте этот сайт в полноценном браузере.</p>
        <a href="#" id="openInBrowserBtn">
            <span class="material-symbols-outlined">arrow_forward</span>
            Открыть в браузере
        </a>
    </div>

    <!-- Основной контент сайта (он будет показан, если мы НЕ в Telegram) -->
    <div class="container" id="app-container">
        <!-- Весь твой HTML-код приложения (формы, кнопки и т.д.) должен быть здесь -->
        <header class="header"><h1>StoriesWall</h1><p>Создай бесшовную стенку из историй для своего профиля. Быстро, бесплатно и прямо в браузере.</p></header>
        <!-- и так далее... -->
    </div>

    <script>
        (function() {
            // Флаг, который определит, нужно ли показывать экран-перехватчик
            let shouldRedirect = false;

            // --- Проверка №1: Через User Agent (для обычных ссылок в TG) ---
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/android/i.test(userAgent) && /telegram/i.test(userAgent)) {
                shouldRedirect = true;
            }
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream && /telegram/i.test(userAgent)) {
                 shouldRedirect = true;
            }

            // --- Проверка №2: Через объект Telegram (для официальных Mini Apps) ---
            // Этот метод надежнее, если он доступен.
            try {
                if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.platform !== 'unknown' && window.Telegram.WebApp.platform !== 'tdesktop') {
                    shouldRedirect = true;
                }
            } catch (e) {
                // Если объекта нет, ничего страшного, продолжим
            }

            // --- Если хотя бы одна проверка сработала ---
            if (shouldRedirect) {
                const overlay = document.getElementById('browser-redirect-overlay');
                const openBtn = document.getElementById('openInBrowserBtn');
                const appContainer = document.getElementById('app-container');

                // Прячем основной контент
                if (appContainer) {
                    appContainer.style.display = 'none';
                }
                
                // Делаем оверлей видимым
                if (overlay) {
                    overlay.classList.add('visible');
                }

                const currentUrl = window.location.href;
                let browserUrl;

                // Для Android создаем специальную intent-ссылку
                if (/android/i.test(userAgent)) {
                    // Убираем http(s):// из URL для intent
                    const cleanUrl = currentUrl.replace(/^(https?:\/\/)/, '');
                    browserUrl = `intent://${cleanUrl}#Intent;scheme=https;package=com.android.chrome;end`;
                } else {
                    // Для iOS и других систем просто даем обычную ссылку
                    browserUrl = currentUrl;
                }
                
                if (openBtn) {
                    openBtn.href = browserUrl;
                }
            } else {
                // Если мы в обычном браузере, можно запустить основную логику приложения
                console.log("Обычный браузер, приложение работает.");
            }
        })();

        // Сюда можно вставить остальной JavaScript твоего приложения
        // (логику кнопок, загрузки файлов и т.д.)
        // Например:
        // const downloadBtn = document.getElementById('downloadBtn');
        // downloadBtn.addEventListener('click', () => { ... });

    </script>
</body>
</html>
